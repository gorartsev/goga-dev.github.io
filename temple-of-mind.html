<script>
  // Карусель без задержек + предзагрузка всех изображений
  document.addEventListener('DOMContentLoaded', function () {
    const carousels = document.querySelectorAll('.carousel');

    carousels.forEach((carousel) => {
      const imagesAttr = carousel.getAttribute('data-images') || '';
      const images = imagesAttr
        .split(',')
        .map((s) => s.trim())
        .filter((s) => s.length > 0);

      if (!images.length) return;

      const imgEl = carousel.querySelector('.carousel-image');
      const prevBtn = carousel.querySelector('.carousel-btn.prev');
      const nextBtn = carousel.querySelector('.carousel-btn.next');
      const dotsContainer = carousel.querySelector('.carousel-dots');

      let index = 0;

      // ПРЕДЗАГРУЗКА ВСЕХ КАРТИНОК
      images.forEach(src => {
        const preload = new Image();
        preload.src = src;
      });

      // Точки
      dotsContainer.innerHTML = '';
      const dots = images.map((_, i) => {
        const dot = document.createElement('div');
        dot.className = 'carousel-dot' + (i === 0 ? ' is-active' : '');
        dotsContainer.appendChild(dot);

        dot.addEventListener('click', () => {
          index = i;
          update();
        });

        return dot;
      });

      function update() {
        imgEl.src = images[index]; // моментальная подмена
        dots.forEach((dot, i) => {
          dot.classList.toggle('is-active', i === index);
        });
      }

      prevBtn.addEventListener('click', () => {
        index = (index - 1 + images.length) % images.length;
        update();
      });

      nextBtn.addEventListener('click', () => {
        index = (index + 1) % images.length;
        update();
      });

      update();
    });
  });
</script>
